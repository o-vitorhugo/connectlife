<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atividades - Connect Life</title>
  <link rel="stylesheet" href="./styles/main.css">
</head>

<body>
  <header>
    <div class="header-content">
      <a href="./index.html" class="logo">ü§ùConnect Life</a>
      <nav>
        <ul>
          <li><a href="./dashboard.html">Dashboard</a></li>
          <li><a id="active" href="./atividades.html">Atividades</a></li>
          <li><a href="./agendamentos.html">Agendamentos</a></li>
          <li><a href="./calendario.html">Calend√°rio</a></li>
          <li><a href="./historico.html">Hist√≥rico</a></li>
          <li><a href="./eventos.html">Eventos</a></li>
        </ul>
      </nav>
      <div class="user-menu">
        <span id="user-name"></span>
        <span id="user-role" class="role-badge"></span>
        <button id="logout-btn" class="btn btn-outline">Sair</button>
      </div>
    </div>
  </header>

  <main style="padding: 2rem 1rem; min-height: 39.5vh;">
    <div class="container">
      <h1 style="margin-bottom: 1rem;">Atividades Dispon√≠veis</h1>
      <p class="text-muted" style="margin-bottom: 2rem;">Explore nossas atividades e encontre a perfeita para voc√™</p>

      <div class="grid grid-cols-3" id="activities-grid"></div>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>Connect Life</h3>
        <p>Conectando gera√ß√µes atrav√©s de atividades significativas.</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025Connect Life. Todos os direitos reservados.</p>
    </div>
  </footer>

  <script src="./js/api.js"></script>
  
  <script src="./js/global.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        // 1Ô∏è‚É£ Verifica autentica√ß√£o (opcional)
        const usuario = API.usuarios.obterUsuarioAtual();

        // 2Ô∏è‚É£ Busca as atividades do servidor
        const atividades = await API.atividades.listar();

        // 3Ô∏è‚É£ Obt√©m o container do grid
        const gradeAtividades = document.getElementById("activities-grid");

        // 4Ô∏è‚É£ Garante que √© array
        const listaAtividades = Array.isArray(atividades) ? atividades : [];

        // 5Ô∏è‚É£ Renderiza cards dinamicamente
        gradeAtividades.innerHTML = listaAtividades
          .map((atividade) => `
          <div class="card">
            <img 
              src="${atividade.imagem || '/img/padrao.jpg'}" 
              alt="${atividade.titulo}" 
              style="width: 100%; height: 200px; object-fit: cover; border-radius: var(--radius); margin-bottom: 1rem;"
            >
            <h3 style="margin-bottom: 0.5rem;">${atividade.titulo}</h3>
            <p class="text-muted" style="margin-bottom: 1rem; font-size: 0.875rem;">
              ${atividade.descricao}
            </p>
            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
              <span class="badge badge-info">${atividade.categoria}</span>
              <span class="badge badge-warning">${atividade.dificuldade || 'N/A'}</span>
            </div>
            <p class="text-muted" style="font-size: 0.875rem; margin-bottom: 1rem;">‚è±Ô∏è ${atividade.duracao || 'Sem dura√ß√£o'}</p>
            ${usuario 
              ? usuario.papel === "IDOSO"
                ? `<a href="./agendar-atividade.html?id=${atividade.id}" class="btn btn-primary" style="width: 100%;">Agendar</a>`
                : ""
              : `<a href="./login.html" class="btn btn-primary" style="width: 100%;">Entrar para Agendar</a>`
            }
          </div>
        `)
          .join("");
      } catch (erro) {
        console.error("[Atividades] Erro ao carregar:", erro);
        const gradeAtividades = document.getElementById("activities-grid");
        if (gradeAtividades) {
          gradeAtividades.innerHTML = `
          <p class="text-danger">Erro ao carregar atividades. Tente novamente mais tarde.</p>
        `;
        }
      }
    });
  </script>

</body>

</html>